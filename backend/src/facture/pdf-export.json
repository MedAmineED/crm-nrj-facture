//////

JE CHANGER SERVICE FACTURE EN BACKEND W E5ER CHANGEMENT MEN GROK
--- FRONT END MABADELETE CHAYY
////
nom / prenom / raison sc / fonction / email / num tel

  async getAllFacturesWithPdfs(filters?: FilterFactureDto) {
    try {
      const queryBuilder = this.factureRepository.createQueryBuilder('facture');

      if (filters) {
        if (filters.type_facture) {
          queryBuilder.andWhere('facture.type_facture = :type_facture', {
            type_facture: filters.type_facture,
          });
        }
        if (filters.num_client) {
          queryBuilder.andWhere('facture.num_client LIKE :num_client', {
            num_client: `%${filters.num_client}%`,
          });
        }
        if (filters.siret) {
          queryBuilder.andWhere('facture.siret LIKE :siret', {
            siret: `%${filters.siret}%`,
          });
        }
        if (filters.code_naf) {
          queryBuilder.andWhere('facture.code_naf = :code_naf', {
            code_naf: filters.code_naf,
          });
        }
        if (filters.code_postal) {
          queryBuilder.andWhere('facture.code_postal LIKE :code_postal', {
            code_postal: `%${filters.code_postal}%`,
          });
        }
        if (filters.pdl) {
          queryBuilder.andWhere('facture.pdl LIKE :pdl', {
            pdl: `%${filters.pdl}%`,
          });
        }
        if (filters.conso_annuelle) {
          queryBuilder.andWhere('facture.conso_annuelle LIKE :conso_annuelle', {
            conso_annuelle: `%${filters.conso_annuelle}%`,
          });
        }
        if (filters.prix_unitaire_min) {
          queryBuilder.andWhere('facture.prix_unitaire >= :prix_unitaire_min', {
            prix_unitaire_min: filters.prix_unitaire_min,
          });
        }
        if (filters.prix_unitaire_max) {
          queryBuilder.andWhere('facture.prix_unitaire <= :prix_unitaire_max', {
            prix_unitaire_max: filters.prix_unitaire_max,
          });
        }
        if (filters.echeance_start && filters.echeance_end) {
          queryBuilder.andWhere(
            'facture.echeance BETWEEN :echeance_start AND :echeance_end',
            {
              echeance_start: filters.echeance_start,
              echeance_end: filters.echeance_end,
            },
          );
        }
        if (filters.creation_date_start && filters.creation_date_end) {
          queryBuilder.andWhere(
            'facture.creation_date BETWEEN :creation_date_start AND :creation_date_end',
            {
              creation_date_start: filters.creation_date_start,
              creation_date_end: filters.creation_date_end,
            },
          );
        }

        if (filters.sortBy) {
          queryBuilder.orderBy(`facture.${filters.sortBy}`, filters.sortOrder || 'ASC');
        }

        if (filters.page && filters.limit) {
          queryBuilder
            .skip((filters.page - 1) * filters.limit)
            .take(filters.limit);
        }
      }

      const total = await queryBuilder.getCount();
      const factures = await queryBuilder.getMany();

      return {
        data: factures,
        total,
        page: filters?.page || 1,
        limit: filters?.limit || total,
      };
    } catch (error) {
      console.error('Error retrieving factures:', error);
      throw error;
    }
  }


